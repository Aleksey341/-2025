<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="mobile-web-app-capable" content="yes" />
  <title>Ваше пожелание</title>

  <style>
    :root{
      --bg1:#0a0a20;
      --bg2:#1a1a3a;
      --accent:#ff4f12;
      --text:#ffffff;
      --card: rgba(255,255,255,0.08);
      --card2: rgba(255,255,255,0.12);
    }
    html,body{height:100%;}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background: radial-gradient(1200px 800px at 20% 20%, #2a2a70 0%, transparent 55%),
                  radial-gradient(1200px 800px at 80% 80%, #3a1a70 0%, transparent 55%),
                  linear-gradient(135deg, var(--bg1) 0%, var(--bg2) 55%, var(--bg1) 100%);
      overflow:hidden;
    }
    .wrap{
      position:relative;
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      box-sizing:border-box;
    }
    .card{
      position:relative;
      z-index:5;
      width:min(720px, 100%);
      border-radius:24px;
      background: linear-gradient(180deg, var(--card) 0%, var(--card2) 100%);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.14);
      box-shadow: 0 20px 60px rgba(0,0,0,0.35);
      padding:26px 22px;
      text-align:center;
    }
    h1{
      margin:0 0 14px 0;
      font-size: clamp(22px, 3.6vw, 34px);
      font-weight:800;
      letter-spacing: 0.2px;
      text-shadow: 0 0 18px rgba(102,126,234,0.35);
    }
    .wish{
      margin: 10px auto 18px;
      font-size: clamp(18px, 3.2vw, 28px);
      line-height: 1.25;
      font-weight: 700;
      padding: 16px 14px;
      border-radius: 18px;
      background: rgba(0,0,0,0.18);
      border: 1px solid rgba(255,255,255,0.10);
      text-shadow: 0 0 14px rgba(255,79,18,0.25);
      min-height: 90px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .hint{
      opacity:.9;
      font-size: 14px;
      line-height: 1.35;
      margin-top: 6px;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      margin-top: 16px;
      padding: 12px 16px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.10);
      color: var(--text);
      font-weight:700;
      cursor:pointer;
      user-select:none;
      transition: transform .15s ease, background .2s ease;
    }
    .btn:active{ transform: scale(0.98); }
    .btn:hover{ background: rgba(255,255,255,0.14); }

    /* лёгкая анимация появления */
    .animate{
      animation: pop .35s ease-out;
    }
    @keyframes pop{
      0%{ transform: translateY(6px); opacity:0; }
      100%{ transform: translateY(0); opacity:1; }
    }

    /* снег */
    #snowflakes{
      position:absolute;
      inset:0;
      z-index:1;
      pointer-events:none;
      overflow:hidden;
    }
    .snowflake{
      position:absolute;
      top:-40px;
      opacity:0.55;
      filter: drop-shadow(0 0 6px rgba(255,255,255,0.15));
      font-size: var(--size, 14px);
      animation: fall var(--duration, 10s) linear infinite;
      animation-delay: var(--delay, 0s);
    }
    @keyframes fall{
      0%{ transform: translateY(-40px); }
      100%{ transform: translateY(calc(100vh + 60px)); }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div id="snowflakes"></div>

    <div class="card">
      <h1>Ваше пожелание</h1>

      <div id="wishText" class="wish animate">Подготавливаем…</div>

      <button class="btn" type="button" onclick="saveScreenshot()">
        Сохранить (скриншот)
      </button>

      <div class="hint">
        Пожелание фиксируется на этом устройстве (если браузер позволяет хранение).
        Если вы открываете из камеры — при необходимости нажмите «Открыть в Safari/Chrome».
      </div>
    </div>
  </div>

  <script>
    /* === ВСТАВЬТЕ СЮДА ВАШ МАССИВ ИЗ 200 ПОЖЕЛАНИЙ === */
    const wishes = [
      "Пусть работа приносит смысл, а не только задачи.",
      "Пусть каждый день даёт один понятный результат.",
      "Пусть ваши усилия замечают и ценят."
      // ... добавьте остальные до 200
    ];

    const STORAGE_KEY = 'rostelecom_wish_2025_v3';

    function $(id){ return document.getElementById(id); }

    // Безопасный доступ к localStorage (вариант 1: если нельзя — всё равно работаем)
    function getStorageSafe() {
      try {
        const t='__storage_test__';
        window.localStorage.setItem(t,'1');
        window.localStorage.removeItem(t);
        return window.localStorage;
      } catch(e){
        return null;
      }
    }

    // FNV-1a 32-bit
    function fnv1a32(str){
      let h = 0x811c9dc5;
      for (let i=0;i<str.length;i++){
        h ^= str.charCodeAt(i);
        h = (h + ((h<<1)+(h<<4)+(h<<7)+(h<<8)+(h<<24))) >>> 0;
      }
      return h >>> 0;
    }

    function getSeedFromURL(){
      try{
        const p = new URLSearchParams(location.search);
        return (p.get('s') || '').trim();
      }catch(e){
        return '';
      }
    }

    function generateToken(){
      const rnd = Math.random().toString(36).slice(2);
      const ua  = (navigator.userAgent || '').slice(0,80);
      const ts  = Date.now().toString(36);
      return `${ts}.${rnd}.${fnv1a32(ua).toString(36)}`;
    }

    function pickWishIndex(token, seed){
      const base = `${token}::${seed}::${wishes.length}`;
      return (fnv1a32(base) % wishes.length);
    }

    function showWish(text){
      const el = $('wishText');
      if(!el) return;
      el.classList.remove('animate');
      el.textContent = text;
      void el.offsetWidth;
      el.classList.add('animate');
    }

    function showError(msg){
      showWish(`Не удалось показать пожелание. ${msg}`);
    }

    function createSnowflakes(){
      const c = $('snowflakes');
      if(!c) return;
      c.innerHTML = '';
      const chars = ['❄','❅','❆','✻','✼'];
      for(let i=0;i<30;i++){
        const fl = document.createElement('div');
        fl.className = 'snowflake';
        fl.textContent = chars[Math.floor(Math.random()*chars.length)];
        fl.style.left = (Math.random()*100) + '%';
        fl.style.setProperty('--size', (10 + Math.random()*15) + 'px');
        fl.style.setProperty('--duration', (8 + Math.random()*10) + 's');
        fl.style.setProperty('--delay', (Math.random()*10) + 's');
        c.appendChild(fl);
      }
    }

    function saveScreenshot(){
      alert('Сделайте скриншот стандартным способом на телефоне, чтобы сохранить пожелание.');
    }
    window.saveScreenshot = saveScreenshot;

    function init(){
      try{
        if(!Array.isArray(wishes) || wishes.length === 0){
          showError('Список пожеланий пуст.');
          return;
        }

        createSnowflakes();

        const storage = getStorageSafe();
        const seed = getSeedFromURL();

        // 1) если сохранено — показать сразу
        if(storage){
          try{
            const raw = storage.getItem(STORAGE_KEY);
            if(raw){
              const data = JSON.parse(raw);
              if(data && typeof data.wish === 'string' && data.wish.trim()){
                showWish(data.wish);
                return;
              }
            }
          }catch(e){
            // игнорируем
          }
        }

        // 2) иначе выбрать новое
        const token = generateToken();
        const index = pickWishIndex(token, seed);
        const wish = wishes[index];

        showWish(wish);

        // 3) сохранить, если можно
        if(storage){
          try{
            storage.setItem(STORAGE_KEY, JSON.stringify({
              token, seed, index, wish, timestamp: Date.now()
            }));
          }catch(e){
            // не критично
          }
        }
      }catch(e){
        console.error(e);
        showError('Обновите страницу.');
      }
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
